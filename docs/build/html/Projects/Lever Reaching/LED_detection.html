

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LED detection &mdash; Behavioral Analysis 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lever Reaching Task Analysis" href="Lever_reaching.html" />
    <link rel="prev" title="Lever Reaching Code Doc" href="Code_doc_Lever_Reaching.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Behavioral Analysis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Locomotion/index.html">Locomotion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Locomotion/Code_doc_Locomotion.html">Locomotion Code Doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Locomotion/Locomotion_task.html">Locomotion Task Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Locomotion/Locomotion_task.html#file-hierarchy">File hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Locomotion/Locomotion_task.html#jupyter-notebook">Jupyter notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Locomotion/Locomotion_task.html#data-analysis">Data analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Locomotion/Locomotion_task.html#misdetection-correction">Misdetection correction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Lever Reaching</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Code_doc_Lever_Reaching.html">Lever Reaching Code Doc</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">LED detection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Lever_reaching.html">Lever Reaching Task Analysis</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Behavioral Analysis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Lever Reaching</a> &raquo;</li>
        
      <li>LED detection</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/Projects/Lever Reaching/LED_detection.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="led-detection">
<h1>LED detection<a class="headerlink" href="#led-detection" title="Permalink to this headline">¶</a></h1>
<p>The LED panel in the experiment chamber captures different events during the experiment such as auditory cue onset, pad contact, reward delivery, etc.</p>
<p>For User:</p>
<p>The LED_detection.py executable file searches the path that you specify for video files. It will take some information about your video frames and it will produce a <strong>.csv</strong> file in the same directory as your video specifying the state of the LED as a binary (0,1) in each frame of your video.</p>
<p>Here are the steps you have to take:</p>
<ol class="arabic">
<li><p>Download the executable <strong>.py</strong> file from <a class="reference external" href="https://github.com/Shiva-A-Lindi/Behavioral-Analysis/tree/master/LED_detection">here</a> and run it in your terminal:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python LED_detecion.py
Enter the full path under which the video file hierarchy resides:OD
(There must not be any videos other than the ones you want analyzed in this directory tree.)
</pre></div>
</div>
</li>
<li><p>Then input the root directory within which all your videos are as instructed above, for example in an IOS device:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/apple/Desktop/Rat_Lever_experiment

Specify the left and right end of the pad and the lever location, resepectively.
</pre></div>
</div>
</li>
<li><p>A window will pop up showing one frame of one of your videos. Specify the left and right  edges of the pad and then the lever center with mouse clicks:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Pad edges (x,y):
[153 364] [254 364]
Lever location (x,y):
[392 184]
Press esc when you&#39;re done to close the windows.
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/Pad_and_lever_pos.png"><img alt="alternate text" src="../../_images/Pad_and_lever_pos.png" style="width: 307.2px; height: 321.0px;" /></a>
</div>
<p>It will mark your selections and show them as in the image above. Press esc to continue.</p>
</li>
<li><p>Then it will ask you to specify crop edges by mouse click in a new emerged window. Cropping around the LED panel will help not to overflow your memory during frame analysis:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Now specify the upper left and lower right corner for cropping
Corners:
[ 13 455]
[395 511]
Press esc when you&#39;re done to close the windows.
</pre></div>
</div>
<p>You will see your selection highlighted in green, as shown below. Press esc to continue.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/Cropped.png"><img alt="alternate text" src="../../_images/Cropped.png" style="width: 380.09999999999997px; height: 321.59999999999997px;" /></a>
</div>
</li>
<li><p>Lastly, you will have to specify the circles corresponding to LED lights:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Specify the center and one point on the edge for each LED

Circle centers and radii ([X, Y, R]):
[[ 23  27  14]
[ 96  34  14]
[173  37  16]
[254  40  13]
[336  40  12]]
Press esc when you&#39;re done to close the windows.
</pre></div>
</div>
<p>It will both show circles drawn around the LEDs (shown below) and report their coordinates for you to evaluate.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/Circles.png"><img alt="alternate text" src="../../_images/Circles.png" style="width: 402.40000000000003px; height: 146.4px;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the mouse clicks have to be in this particular order :</p>
<ol class="arabic simple">
<li><p>Far left LED center</p></li>
<li><p>Far left LED edge point</p></li>
<li><p>Second left center</p></li>
<li><p>Second left edge point…</p></li>
</ol>
</div>
</li>
<li><p>The LEDs change intensity from “off” to “on” state continouesly. Last step is to specify where on the spectrum from minimum to maximum intensity the LED has to be considered switched on. You should input this value as percentage (without the % sign):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Above what percentage of max intensity should be considered switched on? (Either press enter to set the default (25%) or input the percentage value for each LED seperated by spaces.)
30 25 30 40 50
Wait while the LED on-thresholds are set...
runtime =  101  sec
max intensities =  [109  84 173 254 254]
min intensities =  [13 19 22 21 22]

The LED thresholds are as following: [ 42  35  67 114 138]
</pre></div>
</div>
</li>
<li><p>After the threshold are set. It will ask you if you want to proceed with the analysis of all the videos in the root directory you provided in the beginning. You can confirmas below:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Do you want to proceed with analysis of all video files?(y/n)
y
</pre></div>
</div>
</li>
</ol>
<p>After the analysis is finished, you would be able to see the <strong>.csv</strong> files in the same directory as each video.</p>
<p>For developer/contributer:</p>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Video()</strong>:
grabs each video and captures frames for analysis</p></li>
<li><p><strong>Frame()</strong>:
each captured frame by video grabber becomes an instance of this class for further analysis</p></li>
<li><p><strong>LED_class()</strong>:
stores informations regarding the LED lights, such as their location in the image, intensity and the minimum intensity threshold for on and off state.</p></li>
</ul>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>First a few functions to get inputs from user and get things ready for analysis:</p>
<ul class="simple">
<li><p><strong>build_videoPath_list</strong> (<em>path</em>):</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">input</span></code>: full path of the folder containing all videos within directories and subdirectories.</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: a list of strings returning the full path for each video file in the directory tree.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that there should not be any other videos in this directory tree since all of them would be extracted with this function.</p>
</div>
</div></blockquote>
<ul>
<li><p><strong>get_one_frame_from_video</strong> (<em>videofile_path</em>):</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>: full path to a video file</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: a BW frame of the video</p>
</li>
<li><p><strong>crop</strong> (<em>image</em>):</p>
<p>Pops up a window showing a frame of the video and waits for two consecutive mouse clicks. First should be on the left upper corner and second on the right lower corner of the LED panel.
<code class="docutils literal notranslate"><span class="pre">input</span></code>: a BW frame of the video containing the LED panel</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: cropped BW image containing only the LED panel</p>
</li>
<li><p><strong>get_pad_and_lever_from_user</strong> (<em>image</em>)</p>
<p>Pops up a window with full frame and waits for 3 consecutive mouse clicks. 1) left end of the pad, 2) right end of the lever and 3) center of the lever.</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>: a full BW frame of the video</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: an array with 3 entries corresponding to (x,y) coordinates for left and right end of the pad and the center of the lever respectively.</p>
</li>
<li><p><strong>get_circles</strong> (<em>cropped_image</em>):</p>
<p>Pops up the cropped image and gets the center and one point on the edge of the presumed circle for each LED.</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>: BW image presenting the LED panel only</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: returning a (5,3) size array, with (x,y,radius) for each of the 5 LEDs</p>
</li>
<li><p><strong>find_on_threshold</strong> (<em>videoPath_list</em>, <em>X0</em>, <em>X1</em>, <em>Y0</em>, <em>Y1</em>, <em>on_range</em>)</p>
<p>Averages the pixel intensities of each LED in all frames of all videos. LED threshold is set on the first quarter of the max and min range.</p>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code>: <em>videoPath_list</em> is the list of all the full paths of videos. (X0,Y0) is the upper left corner of the cropping rectangle and (X1,Y1) the lower right end. <em>on_range</em> is an array with n_LED elements specifying with what percentage of maximum intensity the LEDs should be considered as on (default is 25% for all).</p>
<p><code class="docutils literal notranslate"><span class="pre">result</span></code>: a list containing 5 values as specific thresholds for each LED.</p>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Lever_reaching.html" class="btn btn-neutral float-right" title="Lever Reaching Task Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Code_doc_Lever_Reaching.html" class="btn btn-neutral float-left" title="Lever Reaching Code Doc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Shiva A. Lindi

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>