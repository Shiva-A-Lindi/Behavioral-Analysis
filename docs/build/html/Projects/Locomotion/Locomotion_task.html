<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Locomotion Task Analysis &mdash; Behavioral Analysis 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lever Reaching" href="../Lever%20Reaching/index.html" />
    <link rel="prev" title="Locomotion Code Doc" href="Code_doc_Locomotion.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Behavioral Analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Locomotion</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Code_doc_Locomotion.html">Locomotion Code Doc</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Locomotion Task Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-hierarchy">File hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jupyter-notebook">Jupyter notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-analysis">Data analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#misdetection-correction">Misdetection correction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Lever%20Reaching/index.html">Lever Reaching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Lever%20Reaching/Code_doc_Lever_Reaching.html">Lever Reaching Code Doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Lever%20Reaching/LED_detection.html">LED detection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/LED_detection.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/LED_detection.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html">Lever Reaching Task Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#file-hierarchy">File hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#experiment">Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#config-file">Config file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#measures">Measures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#misdetection-correction">Misdetection Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#metadata">Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Lever%20Reaching/Lever_reaching.html#jupyter-notebook-and-data-analysis">Jupyter Notebook and Data Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Laser%20Detection/index.html">Laser Detection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Laser%20Detection/Treadmill.html">Treadmill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Laser%20Detection/Open_field.html">Open Field</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../DeepLabCut/index.html">DeepLabCut</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../DeepLabCut/DLC_installation.html">Guide to DeepLabCut installation on Windows 10</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#nvidia-driver-installation">1. Nvidia Driver installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#cuda-toolkit-installation">2. CUDA Toolkit installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#visual-studio-installation">2.1 Visual Studio installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#cuda-installation">2.2 CUDA installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#cudnn-installation">3. cuDNN installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#tensorflow-installation">4. Tensorflow installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#create-virtual-environment">4.1 Create virtual environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#activate-the-environment">4.2 activate the environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#install-tensorflow">4.3 install Tensorflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#check-tensorflow-installation">4.4 check Tensorflow installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../DeepLabCut/DLC_installation.html#deeplabcut-and-wxpython-installation">5. Deeplabcut and wxpython installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Behavioral Analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Locomotion</a> &raquo;</li>
      <li>Locomotion Task Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Projects/Locomotion/Locomotion_task.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="locomotion-task-analysis">
<h1>Locomotion Task Analysis<a class="headerlink" href="#locomotion-task-analysis" title="Permalink to this headline"></a></h1>
<section id="file-hierarchy">
<h2>File hierarchy<a class="headerlink" href="#file-hierarchy" title="Permalink to this headline"></a></h2>
<p>The root directory to your project should have this hierarchy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>root
|-- Animal_Type_1                       &lt;-- all data for one specific animal type e.g. &#39;FoxP2-Cre&#39;
|       |-- ChR2                        &lt;-- Optogenetic expression
|       |       |-- Animal_0            &lt;-- data for one animal in that animal type.
|       |       |       |-- Protocol_0  &lt;-- folders separate protocols e.g. &#39;Square_1_mW&#39;
|       |       |       |       |-- DLC &lt;-- contains body part trackings of all sessions derived from DLC
|       |       |       |       |       |-- session_0_DLC.xlsx
|       |       |       |       |       .
|       |       |       |       |       .
|       |       |       |       `-- Laser &lt;-- contains laser detection files
|       |       |       |               |-- session_0_laser.xlsx
|       |       |       |               |-- session_1_laser.xlsx
|       |       |       |               .
|       |       |       |               .
|       |       |       .
|       |       |       .
|       |       |       |-- Protocol_n
|       |       |       |
|       |       |       `-- Spontaneous &lt;-- Same everything just for Spontaneous sessions
|       |       |               `DLC    &lt;-- only DLC folder since there&#39;s no laser
|       |       |
|       |       |-- Animal_1            &lt;-- same for all other animals
|       |       .
|       |       .
|       |       |
|       |       `-- Animal_n
|       `-- Control
|               |-- Animal_0
|               .
|               `-- Animal_m
|
|-- Animal_Type_1
|
|
|-- Animal_Type_n                       &lt;-- same for all other animal types
|
|-- data_npz
|       |-- Protocol_0
|       |       |-- ChR2
|       .       `-- Control
|       .
|       |
|       `-- Protocol_n
|
`-- Subplots
</pre></div>
</div>
</section>
<section id="jupyter-notebook">
<h2>Jupyter notebook<a class="headerlink" href="#jupyter-notebook" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://github.com/Shiva-A-Lindi/Behavioral-Analysis/tree/master/Locomotion">Here</a> you will find the jupyter notebook that contains different aspects of Locomotion task data analysis.</p>
<p>In the same location you would also find the <em>Locomotion.py</em> moodule used for this analysis. Here’s the <a class="reference external" href="https://shiva-a-lindi.github.io/Behavioral-Analysis/build/html/Projects/Locomotion/Code_doc_Locomotion.html">documentation</a> for its functions.</p>
<p>In order to start work on data analysis, you have to first fix some parameters specified under heading <strong>Constants</strong>:</p>
<p><code class="docutils literal notranslate"><span class="pre">video_height</span></code> : the height of video in pixels</p>
<p><code class="docutils literal notranslate"><span class="pre">video_width</span></code> : the width in pixels</p>
<p><code class="docutils literal notranslate"><span class="pre">fps</span></code> : number of frames per second of video</p>
<p><code class="docutils literal notranslate"><span class="pre">left_edge_x</span></code> : left end of treadmil in the frame in pixels</p>
<p><code class="docutils literal notranslate"><span class="pre">right_edge_x</span></code>  : right end of treadmil in the frame in pixels</p>
<p><code class="docutils literal notranslate"><span class="pre">treadmill_len</span></code> : True length of the treadmill in cm</p>
<p><code class="docutils literal notranslate"><span class="pre">elec_shock</span></code> : length of the electro shock section of the treadmil in cm</p>
<p><code class="docutils literal notranslate"><span class="pre">treadmil_velocity</span></code> : velocity of the treadmill during task in cm/s</p>
<p><code class="docutils literal notranslate"><span class="pre">interval_in_sec</span></code> : duration of stimulation in sec</p>
<p><code class="docutils literal notranslate"><span class="pre">pre_stim_interval</span></code> : pre stimulus interval in sec for looking at x ,v and acceleration</p>
<p><code class="docutils literal notranslate"><span class="pre">pre_stim_interval_measure</span></code> : pre stimulus interval in seconds for the laser-OFF epoch before laser</p>
<p><code class="docutils literal notranslate"><span class="pre">post_stim_interval_measure</span></code> : pre stimulus interval in seconds for the laser-OFF epoch after stimulation</p>
<p><code class="docutils literal notranslate"><span class="pre">n_timebin</span></code> : number of frames for diffrentriation of position to yield velocity</p>
<p><code class="docutils literal notranslate"><span class="pre">window_pos</span></code> : moving average window for position curve smoothing</p>
<p><code class="docutils literal notranslate"><span class="pre">window_veloc</span></code> : moving average window for velocity curve smoothing</p>
<p><code class="docutils literal notranslate"><span class="pre">max_speed</span></code> : the presumed max speed of the animal to use for misdetections</p>
<p><code class="docutils literal notranslate"><span class="pre">mouse_no_dict</span></code> : Animal number dictionary. Every item is a tuple of two lists, first element represents <em>ChR2</em> animals and second element the <em>Control</em>
e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;D2&#39;</span> <span class="p">:</span> <span class="p">([</span><span class="mi">156</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">199</span><span class="p">],[</span><span class="mi">172</span><span class="p">,</span> <span class="mi">178</span><span class="p">]),</span>
<span class="s1">&#39;Vglut2&#39;</span><span class="p">:([</span><span class="mi">116</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">166</span><span class="p">],[</span><span class="mi">359</span><span class="p">,</span> <span class="mi">360</span><span class="p">]),</span>
<span class="s1">&#39;FoxP2&#39;</span><span class="p">:([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">27</span><span class="p">],[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">26</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pre_direct</span></code> : path to the root directory shown above</p>
</section>
<section id="data-analysis">
<h2>Data analysis<a class="headerlink" href="#data-analysis" title="Permalink to this headline"></a></h2>
<p>We first extract sessions from the readings obtained from the DeepLabCut package :</p>
<a class="reference internal image-reference" href="../../_images/Locomotion_position.png"><img alt="../../_images/Locomotion_position.png" class="align-center" src="../../_images/Locomotion_position.png" style="width: 480.0px; height: 320.0px;" /></a>
<p>Where the blue shades show the intervals with laser stimulation.</p>
<p>We then extract all the windows that contain a certain period (<code class="docutils literal notranslate"><span class="pre">pre_stim_interval_measure</span></code>) before laser onset, the duration of laser and (<code class="docutils literal notranslate"><span class="pre">interval_in_sec</span></code>) and a period after (<code class="docutils literal notranslate"><span class="pre">post_stim_interval_measure</span></code>).</p>
<a class="reference internal image-reference" href="../../_images/Average_trials.png"><img alt="../../_images/Average_trials.png" class="align-center" src="../../_images/Average_trials.png" style="width: 499.79999999999995px; height: 336.0px;" /></a>
<p>If the experimenter has provided sessions with no laser stimulation (black line, here addressed as <em>Spontaneous</em>), we extraced the same number of trials from those sessions and plots them together to have an internal control.</p>
<dl class="simple">
<dt>You will find the chance to assess your data through a variety of options:</dt><dd><ul class="simple">
<li><p>look at single trials of specific animals,</p></li>
<li><p>averages of all or specific sessions for individual animals and all the animals at once.</p></li>
<li><p>You would also be able to categorize trials based on their charecteristics in the miliseconds prior to lase stimulation to see how the intial conditions would change the behavior during laser stimulation.</p></li>
<li><p>compare average of a chosen measure <em>position</em>, <em>velocity</em> or acceleration within an animal type group or between groups or for different animal groups with different optogenetic expression</p></li>
<li><p>distribution of pre laser position for individual animals</p></li>
<li><p>Compare the effect of simultaneous or separate laser stimulation in different brain areas within the same animal group e.g. stimulation of Subthalamic nucleus and External Globus Pallidus in Vglut2-Cre transgenic animals.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="misdetection-correction">
<h2>Misdetection correction<a class="headerlink" href="#misdetection-correction" title="Permalink to this headline"></a></h2>
<p>Even with an optimized trained network it so happens that there are mistakes in the trackings of body parts. This causes crazy changes in velocity of the animal and yield a noisy reading of what we are looking for.
Here we try to reduce this type of noise in the data by thresholding and comparison between the two sets of data from identical cameras on each side.</p>
<p>Here are the steps taken:</p>
<p class="plantuml">
<img src="../../_images/plantuml-8509cee599c2c2e219b8b6b5b9cbf03dd4c1c0b8.png" alt="&#64;startuml

if (&lt;size:16&gt;**Average both right and left side?**&lt;/size&gt;) then (yes)
   fork
     if (Is there a shift between the right and left sides?) then (yes)
             :Correct shift;
     else (no)

     endif

     :Compare right and left traces, detect where \n there's an unacceptable deviance;

     :Decide which side is faulty;

             :Replace the above detections with the average of \n surrounding detections of the non-faulty side in time;

             :Average the left and right side detections;
       endfork
else (no)

endif

while (Detect unreasonalble detections with velocity threshold)

   :Replace the above detections with the \n average of surrounding detections in time;
endwhile (no more misdetections)


stop

&#64;enduml"/>
</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Code_doc_Locomotion.html" class="btn btn-neutral float-left" title="Locomotion Code Doc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Lever%20Reaching/index.html" class="btn btn-neutral float-right" title="Lever Reaching" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Shiva A. Lindi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>